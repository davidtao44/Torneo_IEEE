<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel de Administración</title>
</head>
<body>
  <h1>Panel de Administración</h1>
  <ul id="inscriptionsList"></ul>
  <script type="module">
    // Importa Supabase como un módulo por defecto
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    // Configuración de Supabase
    const supabaseUrl = 'https://vomdmiogipuenyjdqzdp.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZvbWRtaW9naXB1ZW55amRxemRwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzg4NTMyNzYsImV4cCI6MjA1NDQyOTI3Nn0.XHwc6dz-PxBZDMxSqNoydjF44Ku-Fsr8RL3kUvoRsZA';

    // Inicializa Supabase
    const supabase = createClient(supabaseUrl, supabaseKey);

    const inscriptionsList = document.getElementById('inscriptionsList');

    async function loadInscriptions() {
  try {
    // Consulta todos los registros de la tabla inscriptions
    const { data, error } = await supabase
      .from('inscriptions')
      .select('*')
      .order('created_at', { ascending: false });

    if (error) throw error;

    // Limpia la lista antes de agregar nuevos elementos
    inscriptionsList.innerHTML = '';

    // Agrega cada inscripción a la lista
    data.forEach((item) => {
      const li = document.createElement('li');
      li.innerHTML = `
        <strong>${item.full_name}</strong> (${item.email}) - 
        Estado: ${item.approved ? 'Aprobado' : 'Pendiente'}
      `;

      // Solo agrega el botón si la inscripción no está aprobada
      if (!item.approved) {
        const approveButton = document.createElement('button');
        approveButton.textContent = 'Aprobar';
        approveButton.addEventListener('click', async () => {
          await approve(item.id);
          approveButton.remove(); // Elimina el botón después de aprobar
        });
        li.appendChild(approveButton);
      }

      inscriptionsList.appendChild(li);
    });
  } catch (error) {
    console.error('Error al cargar las inscripciones:', error);
    inscriptionsList.innerHTML = '<li>Error al cargar las inscripciones.</li>';
  }
}

    async function approve(id) {
      try {
        // Actualiza el estado de la inscripción a "aprobado"
        const { data, error } = await supabase
          .from('inscriptions')
          .update({ approved: true })
          .eq('id', id);

        if (error) throw error;

        alert('Inscripción aprobada.');
        loadInscriptions(); // Recarga la lista después de aprobar
      } catch (error) {
        console.error('Error al aprobar la inscripción:', error);
        alert('Error al aprobar la inscripción.');
      }
    }

    // Carga las inscripciones al cargar la página
    loadInscriptions();
  </script>
</body>
</html>